{% extends 'base.html' %}

{% block content %}
<div class="post-container" style="max-width: 900px; margin: auto; font-family: Arial, sans-serif; background-color: #f9f9f9; border: 1px solid #ccc; padding: 20px; border-radius: 4px;">

  <div class="post-header" style="border-bottom: 1px solid #ddd; padding-bottom: 10px; margin-bottom: 15px;">
    <h2 style="margin: 0; font-weight: bold; color: #333;">{{ post.title }}</h2>
    <div style="font-size: 0.9rem; color: #777;">
      Автор: <strong>{{ post.user.username }}</strong> | {{ post.created_at|date:"d.m.Y H:i" }}
    </div>
  </div>

  <div class="post-content" style="font-size: 1rem; line-height: 1.6; color: #444; padding-bottom: 20px;">
    {{ post.content|linebreaks }}
  </div>

  <hr style="margin: 0 0 20px 0; border-color: #ddd;">

  <h3 style="font-size: 1.2rem; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-bottom: 15px; color: #0066cc;">Комментарии</h3>

  <div class="comments-section" style="margin-bottom: 30px;">
    {% include "_comment.html" with comments=comments reply_to=reply_to %}
  </div>

  <div class="comment-form-wrapper" style="background-color: #fff; border: 1px solid #ccc; padding: 15px; border-radius: 4px;">
    <h4 style="font-weight: bold; margin-bottom: 15px; color: #0066cc;">Добавить комментарий</h4>

    <form method="post" action="{% url 'forum_post_detail' post.pk %}" id="comment-form" style="display: flex; flex-direction: column; gap: 10px;">
      {% csrf_token %}

      {{ form.parent_id }}

      <label for="{{ form.content.id_for_label }}" style="font-weight: 600;">Сообщение</label>
      {{ form.content }}

      {% if form.errors.content %}
        <div class="text-danger small">{{ form.errors.content }}</div>
      {% endif %}

      <button type="submit" class="btn btn-primary" style="align-self: flex-start; padding: 8px 16px; font-weight: 600;">Отправить</button>
    </form>
  </div>

</div>

<script>
document.querySelectorAll('.reply-link').forEach(function(link) {
  link.addEventListener('click', function(e) {
    e.preventDefault();
    var commentId = this.getAttribute('data-comment-id');
    var parentInput = document.getElementById('id_parent_id');
    if (parentInput) {
      parentInput.value = commentId;
    }
    document.getElementById('comment-form').scrollIntoView({behavior: "smooth"});
  });
});
</script>

{% endblock %}
