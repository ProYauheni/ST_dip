{% extends 'base.html' %}

{% block content %}
<h2 class="text-center">Список бюллетеней СТ «{{ community.name }}»</h2>

{% if is_chairman %}
    <p class="text-end">
    <a href="{% url 'create_ballot' %}" class="btn btn-success mt-3">Создать новый бюллетень</a>
    </p>
{% endif %}



<div class="table-responsive">
  <table class="table table-bordered table-striped align-middle text-center">
      <thead class="table-light">
          <tr>
              <th>Бюллетень</th>
              <th>Период голосования</th>
              <th>Активно</th>
              <th>Действия</th>
          </tr>
      </thead>
      <tbody>
      {% for ballot in ballots %}
          <tr>
              <td class="text-start">
                <a href="{% url 'ballot_vote' ballot.id %}" class="d-block d-sm-inline">
                  Бюллетень заочного голосования от {{ ballot.start_date|date:"d.m.Y" }}
                </a>
              </td>
              <td class="align-middle">{{ ballot.start_date|date:"d.m.Y" }} - {{ ballot.end_date|date:"d.m.Y" }}</td>
              <td class="align-middle">
                  {% if ballot.active %}
                      <span class="badge bg-success">Да</span>
                  {% else %}
                      <span class="btn btn-sm btn-danger disabled" style="pointer-events: none;">Нет</span>
                  {% endif %}
              </td>
              <td class="align-middle">
                  <div class="btn-group flex-wrap" role="group" aria-label="Действия с бюллетенем">
                  {% if is_chairman %}
                      {% if ballot.active %}
                          <a href="{% url 'edit_ballot' ballot.id %}" class="btn btn-sm btn-primary mb-1">Редактировать</a>

                          <form method="post" action="{% url 'delete_ballot' ballot.id %}" class="d-inline mb-1"
                                onsubmit="return confirm('Подтвердите удаление бюллетеня. Это действие невозможно отменить. Продолжить?');">
                              {% csrf_token %}
                              <button type="submit" class="btn btn-sm btn-danger">Удалить</button>
                          </form>

                          <form method="post" action="{% url 'ballot_finish' ballot.id %}" class="d-inline mb-1"
                                onsubmit="return confirm('Завершить голосование? Действие нельзя отменить. Продолжить?');">
                              {% csrf_token %}
                              <button type="submit" class="btn btn-sm btn-warning">Завершить</button>
                          </form>

                      {% endif %}
                      <a href="{% url 'ballot_results' ballot.id %}" class="btn btn-sm btn-info mb-1">Посмотреть результаты</a>
                  {% elif is_board_member %}
                      <a href="{% url 'ballot_results' ballot.id %}" class="btn btn-sm btn-info mb-1">Посмотреть результаты</a>
                      <a href="{% url 'ballot_voters' ballot.id %}" class="btn btn-sm btn-secondary mb-1">Показать проголосовавших</a>
                  {% else %}
                      <a href="{% url 'ballot_results' ballot.id %}" class="btn btn-sm btn-info mb-1">Посмотреть результаты</a>
                  {% endif %}
                  </div>
              </td>
          </tr>
      {% empty %}
          <tr><td colspan="4" class="text-center">Бюллетени не найдены.</td></tr>
      {% endfor %}
      </tbody>
  </table>
</div>

<style>
  @media (max-width: 576px) {
    .btn-group .btn {
      width: 100%;
    }
  }
</style>

{% endblock %}
