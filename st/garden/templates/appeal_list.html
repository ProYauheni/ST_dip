{% extends 'base.html' %}
{% block content %}
<h2 class="text-center">Мои обращения</h2>
<div class="table-responsive">
    <table class="table">
        <thead>
            <tr>
                <th>Тип</th>
                <th>Текст</th>
                <th>Дата обращения</th>
                <th>Ответ</th>
                <th>Кто ответил</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for appeal in appeals %}
            <tr>
                <td>{{ appeal.get_appeal_type_display }}</td>
                <td>{{ appeal.text }}</td>
                <td>{{ appeal.created_at|date:"d.m.Y H:i" }}</td>
                <td>
                    {% if appeal.response %}
                        {{ appeal.response }}<br>
                        <small>{{ appeal.responded_at|date:"d.m.Y H:i" }}</small>
                    {% else %}
                        <em>Ожидает ответа</em>
                    {% endif %}
                </td>
                <td>
                    {% if appeal.responder %}
                        {{ appeal.responder.get_full_name|default:appeal.responder.username }}
                    {% else %}
                        <em>—</em>
                    {% endif %}
                </td>
                <td>
                    <form method="post" action="{% url 'appeal_delete' appeal.pk %}" onsubmit="return confirm('Удалить обращение?');">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-danger">Удалить</button>
                    </form>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6">У вас нет обращений.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<button type="button" class="btn btn-primary" onclick="window.location.href='{% url 'appeal_create' %}'">
    Создать новое обращение
</button>
{% endblock %}
